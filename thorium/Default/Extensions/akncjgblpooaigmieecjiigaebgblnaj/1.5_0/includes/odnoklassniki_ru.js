!function(e){function t(t){for(var o,i,s=t[0],c=t[1],d=t[2],l=0,f=[];l<s.length;l++)i=s[l],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(u&&u(t);f.length;)f.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(o=!1)}o&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var o={},r={8:0},a=[];function i(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=o,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window.savefromContentScriptWebpackJsonp=window.savefromContentScriptWebpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var u=c;a.push([122,0]),n()}({108:function(e,t,n){var o;e.exports=(o=n(109),function(e){var t=o,n=t.lib,r=n.WordArray,a=n.Hasher,i=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=i.MD5=a.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,r=e[o];e[o]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var a=this._hash.words,i=e[t+0],c=e[t+1],p=e[t+2],h=e[t+3],v=e[t+4],m=e[t+5],g=e[t+6],y=e[t+7],k=e[t+8],b=e[t+9],w=e[t+10],x=e[t+11],O=e[t+12],_=e[t+13],M=e[t+14],S=e[t+15],C=a[0],P=a[1],I=a[2],L=a[3];C=d(C,P,I,L,i,7,s[0]),L=d(L,C,P,I,c,12,s[1]),I=d(I,L,C,P,p,17,s[2]),P=d(P,I,L,C,h,22,s[3]),C=d(C,P,I,L,v,7,s[4]),L=d(L,C,P,I,m,12,s[5]),I=d(I,L,C,P,g,17,s[6]),P=d(P,I,L,C,y,22,s[7]),C=d(C,P,I,L,k,7,s[8]),L=d(L,C,P,I,b,12,s[9]),I=d(I,L,C,P,w,17,s[10]),P=d(P,I,L,C,x,22,s[11]),C=d(C,P,I,L,O,7,s[12]),L=d(L,C,P,I,_,12,s[13]),I=d(I,L,C,P,M,17,s[14]),C=u(C,P=d(P,I,L,C,S,22,s[15]),I,L,c,5,s[16]),L=u(L,C,P,I,g,9,s[17]),I=u(I,L,C,P,x,14,s[18]),P=u(P,I,L,C,i,20,s[19]),C=u(C,P,I,L,m,5,s[20]),L=u(L,C,P,I,w,9,s[21]),I=u(I,L,C,P,S,14,s[22]),P=u(P,I,L,C,v,20,s[23]),C=u(C,P,I,L,b,5,s[24]),L=u(L,C,P,I,M,9,s[25]),I=u(I,L,C,P,h,14,s[26]),P=u(P,I,L,C,k,20,s[27]),C=u(C,P,I,L,_,5,s[28]),L=u(L,C,P,I,p,9,s[29]),I=u(I,L,C,P,y,14,s[30]),C=l(C,P=u(P,I,L,C,O,20,s[31]),I,L,m,4,s[32]),L=l(L,C,P,I,k,11,s[33]),I=l(I,L,C,P,x,16,s[34]),P=l(P,I,L,C,M,23,s[35]),C=l(C,P,I,L,c,4,s[36]),L=l(L,C,P,I,v,11,s[37]),I=l(I,L,C,P,y,16,s[38]),P=l(P,I,L,C,w,23,s[39]),C=l(C,P,I,L,_,4,s[40]),L=l(L,C,P,I,i,11,s[41]),I=l(I,L,C,P,h,16,s[42]),P=l(P,I,L,C,g,23,s[43]),C=l(C,P,I,L,b,4,s[44]),L=l(L,C,P,I,O,11,s[45]),I=l(I,L,C,P,S,16,s[46]),C=f(C,P=l(P,I,L,C,p,23,s[47]),I,L,i,6,s[48]),L=f(L,C,P,I,y,10,s[49]),I=f(I,L,C,P,M,15,s[50]),P=f(P,I,L,C,m,21,s[51]),C=f(C,P,I,L,O,6,s[52]),L=f(L,C,P,I,h,10,s[53]),I=f(I,L,C,P,w,15,s[54]),P=f(P,I,L,C,c,21,s[55]),C=f(C,P,I,L,k,6,s[56]),L=f(L,C,P,I,S,10,s[57]),I=f(I,L,C,P,g,15,s[58]),P=f(P,I,L,C,_,21,s[59]),C=f(C,P,I,L,v,6,s[60]),L=f(L,C,P,I,x,10,s[61]),I=f(I,L,C,P,p,15,s[62]),P=f(P,I,L,C,b,21,s[63]),a[0]=a[0]+C|0,a[1]=a[1]+P|0,a[2]=a[2]+I|0,a[3]=a[3]+L|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var a=e.floor(o/4294967296),i=o;n[15+(r+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n[14+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,c=s.words,d=0;d<4;d++){var u=c[d];c[d]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return s},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});function d(e,t,n,o,r,a,i){var s=e+(t&n|~t&o)+r+i;return(s<<a|s>>>32-a)+t}function u(e,t,n,o,r,a,i){var s=e+(t&o|n&~o)+r+i;return(s<<a|s>>>32-a)+t}function l(e,t,n,o,r,a,i){var s=e+(t^n^o)+r+i;return(s<<a|s>>>32-a)+t}function f(e,t,n,o,r,a,i){var s=e+(n^(t|~o))+r+i;return(s<<a|s>>>32-a)+t}t.MD5=a._createHelper(c),t.HmacMD5=a._createHmacHelper(c)}(Math),o.MD5)},109:function(e,t,n){(function(t){var o;e.exports=(o=o||function(e,o){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==t&&t.crypto&&(r=t.crypto),!r)try{r=n(!function(){var e=new Error("Cannot find module 'crypto'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){}var a=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),s={},c=s.lib={},d=c.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=c.WordArray=d.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes,r=e.sigBytes;if(this.clamp(),o%4)for(var a=0;a<r;a++){var i=n[a>>>2]>>>24-a%4*8&255;t[o+a>>>2]|=i<<24-(o+a)%4*8}else for(a=0;a<r;a+=4)t[o+a>>>2]=n[a>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=d.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(a());return new u.init(t,e)}}),l=s.enc={},f=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],r=0;r<n;r++){var a=t[r>>>2]>>>24-r%4*8&255;o.push((a>>>4).toString(16)),o.push((15&a).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new u.init(n,t/2)}},p=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],r=0;r<n;r++){var a=t[r>>>2]>>>24-r%4*8&255;o.push(String.fromCharCode(a))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new u.init(n,t)}},h=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},v=c.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,o=this._data,r=o.words,a=o.sigBytes,i=this.blockSize,s=a/(4*i),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*i,d=e.min(4*c,a);if(c){for(var l=0;l<c;l+=i)this._doProcessBlock(r,l);n=r.splice(0,c),o.sigBytes-=d}return new u.init(n,d)},clone:function(){var e=d.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(c.Hasher=v.extend({cfg:d.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}}),s.algo={});return s}(Math),o)}).call(this,n(110))},110:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},122:function(e,t,n){"use strict";n.r(t);var o=n(6),r=n(7),a=n(14),i=n(9),s=n(23),c=n(10),d=n(5),u=n.n(d),l=n(0),f=n(19),p=n(20),h=n(34),v=n(35),m=n(29),g=n(49),y=n(16),k=n(30),b=n(24),w=n(46),x=n(3),O=n(2),_=n(27),M=n(8),S=n(11);var C=function(e){for(var t=[];e.parentElement&&1===e.parentElement.nodeType;){var n="",o=[].slice.call(e.parentElement.children);o.length>1&&(n=":nth-child(".concat(o.indexOf(e)+1,")")),t.unshift("".concat(e.tagName).concat(n)),e=e.parentElement}return t.join(">")},P=n(25),I=n(15),L=n(39),j=n(41),N=n(21),q=function(e,t){var n=(new DOMParser).parseFromString("<html><body>"+e+"</body></html>","text/html");if(t){var o=n.head.querySelector("base");o||((o=n.createElement("base")).href=t,n.head.appendChild(o))}return n},A=n(36),E=n(22),T=n(4),R=n(32),D=n(47),B=n(13),F=n(26),H=n(56),U=Object(S.a)("odnoklassniki_ru"),V=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome");P.a.isSingle()&&Object(p.b)("odnoklassniki",(function(e,t){var d=Object(f.a)(t),p=t.preferences,S=p.moduleOdnoklassniki?1:0,P=l.a.isChrome||l.a.isFirefox||l.a.isGM&&l.a.isTM;l.a.onMessage.addListener((function(t,n,o){if("getModuleInfo"===t.action){if(t.url!==location.href)return;return o({state:S,moduleName:e})}if("changeState"===t.action){if(e!==t.moduleName)return;return z.changeState(t.state)}"updatePreferences"!==t.action?S&&("updateLinks"===t.action&&W(),"downloadMP3Files"===t.action&&(P?K.downloadMP3Files():K.showListOfAudioFiles(!1)),"downloadPlaylist"===t.action&&K.showListOfAudioFiles(!0)):Object.assign(p,t.preferences)})),S&&setTimeout((function(){z.run()}));var z={linkCache:{},contextMenu:null,videoToken:null,run:function(){if(S=1,K.getJsSessionId(),Y.injectStyle(),X.injectStyle(),I.a.isAvailable())return z.mutationMode.enable()},changeState:function(e){S=e,G.rmBtn(),K.disable(),X.rmCurrentPhotoBtn(),Y.disable(),Y.rmBtn(),z.hideMenu(),z.mutationMode.stop(),z.clearCache(),e&&z.run()},hideMenu:function(){z.contextMenu&&(z.contextMenu.hide(),z.contextMenu=null)},clearCache:function(){var e=z.linkCache;for(var t in e)delete e[t]},mutationMode:{observer:null,stop:function(){this.observer&&this.observer.stop(),["sfSkip"].forEach((function(e){for(var t,n=Object(m.a)(e),o=document.querySelectorAll("["+n+"]"),r=0;t=o[r];r++)t.removeAttribute(n)}))},wrapOnPhotoOver:function(){S&&X.addCurrentDlBtn(this)},wrapVideoFeedOnImgOver:function(){S&&Y.onImgOver.call(this)},wrapAudioOnMouseOver:function(){S&&K.onMouseOver.apply(this,arguments)},wrapAudioOnMouseOut:function(){S&&K.onMouseOut.apply(this,arguments)},wrapNewAudioOnMouseEnter:function(){if(S)try{K.onNewMouseEnter.apply(this,arguments)}catch(e){U.error("wrapNewAudioOnMouseEnter error",e)}},enable:function(){if(this.observer)return this.observer.start();var e=this,t=function(t){for(var n,o=0;n=t.added[o];o++)n.sfSkip>0||(n.sfSkip="1",x.a.on(n,"mouseenter",e.wrapAudioOnMouseOver),x.a.on(n,"mouseleave",e.wrapAudioOnMouseOut))},n=function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.added.filter((function(e){return!e.dataset.sfReady})).map((function(e){return e.dataset.sfReady=1,e})).map((function(e){var t=document.createElement("a");Object(B.a)({category:"append",subcategory:"ok",event:"b"}),t.classList.add("sf-audio","savefrom_ok_download"),e.style.position="relative",e.appendChild(t),t.style.position="absolute",t.style.top="10px",t.style.right="15px",t.style.width="16px",t.style.height="16px";var n=e.closest(".track-with-cover").dataset.trackId;t.addEventListener("click",(function(t){Object(B.a)({category:"download",subcategory:"ok",event:"track"}),t.stopPropagation(),t.preventDefault();var n=e.closest(".track-with-cover"),o=n.querySelector('[data-l="t,artist"]').textContent,r=n.querySelector('[data-l="t,album"]').textContent,a=M.a.modify("".concat(o," - ").concat(r));l.a.sendMessage({action:"downloadFile",options:{filename:a+".mp3",url:t.target.href}})})),e.closest(".track-with-cover").addEventListener("mouseleave",(function(){return t.style.display="none"})),e.addEventListener("mouseenter",(function(){t.style.display="block",t.href||l.a.sendMessage({action:"getOdnoklassnikiAudioLinks",url:location.href,trackId:n,jsessionId:K.jsessionId},(function(e){var n=e.data;K.getClientHash(n.play).then((function(e){t.href=n.play+(e?"&clientHash="+e:"");var o=n.track,r=Math.floor(o.size/o.duration/125)+" "+l.a.i18n.getMessage("kbps"),a=d.sizeHuman(o.size,2);t.title="".concat(a," ~ ").concat(r)}))}))}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(t){for(var n,o=0;n=t.added[o];o++)n.dataset.sfSkip>0||(n.dataset.sfSkip="1",x.a.one(n,"mouseenter",e.wrapVideoFeedOnImgOver))},r=[];"m.ok.ru"===location.host&&r.push({css:".music_track_i:not(.actionButton)",is:"added",callback:function(e){e.added.forEach((function(e){e.sfSkip||(e.sfSkip="1",K.appendDownloadMobileMusic(e))}))}},{css:"#mvplayer_cont, .feed-card_item .vdo.playb, .theme-comments-head [data-video]",is:"added",callback:function(e){e.added.forEach((function(e){if(!e.dataset.sfSkip){e.dataset.sfSkip="1";var t=e.closest(".section, .feed-card, .theme-comments-head");t&&G.appendDownloadMobileVideo(t)}}))}}),this.observer=new I.a({queries:[].concat(r,[{css:".track.js-track, .track-with-cover.h-mod",is:"added",callback:t},{css:".track-with-cover_cnt",is:"added",callback:n},{css:".mus-tr_i",is:"added",callback:t},{css:"#photo-layer_photo",is:"added",callback:function(t){if(!l.a.isSafari)for(var n,o=0;n=t.added[o];o++)n.dataset.sfSkip>0||(n.dataset.sfSkip="1",x.a.one(n,"mouseenter",e.wrapOnPhotoOver))}},{css:".vp_video .vid-card_cnt",is:"added",callback:function(e){for(var t,n=0;t=e.added[n];n++)if(!(t.dataset.sfSkip>0)){t.dataset.sfSkip="1";var o=Object(b.a)(t,".vp_video");if(!o)return;var r=G.getPlayerOptions(t);r&&G.appendLinkUnderVideo(o.parentNode,r)}}},{css:".vid-card_cnt .vid-card_cnt_w img",is:"added",callback:function(t){for(var n,o=0;n=t.added[o];o++)if(!(n.dataset.sfSkip>0)){if(n.dataset.sfSkip="1",(n=Object(h.a)(n,"vid-card_cnt")).dataset.sfSkip)return;x.a.one(n,"mouseenter",e.wrapVideoFeedOnImgOver)}}},{css:".d_comment_text_w img",is:"added",callback:o},{css:".video-card .video-card_img-w img",is:"added",callback:o},{css:".vid-card_cnt img, .html5-vpl_vid",is:"added",callback:o},{css:".".concat(x.a.onRemoveClassName),is:"removed",callback:function(e){for(var t,n=0;t=e.removed[n];n++)x.a.onRemoveListener(t)}},{css:".sf-video-feed-bind-on-insert",is:"added",callback:function(e){for(var t,n=0;t=e.added[n];n++)t.addEventListener("click",Y.onBtnClick),Object(B.a)({category:"append",subcategory:"ok",event:"b"})}},{css:["wm-track","wm-track2"],is:"added",callback:function(t){for(var n,o=0;n=t.added[o];o++)n.dataset.sfSkip>0||(n.dataset.sfSkip="1",x.a.one(n,"mouseenter",e.wrapNewAudioOnMouseEnter))}}])})}}},W=function(){z.clearCache(),J(),K.getJsSessionId(),G.catchPopup()},J=function(){for(var e=document.querySelectorAll(".savefrom_ok_download"),t=e.length-1;t>=0;t--)e[t].parentNode.removeChild(e[t])},K={downloadIdPrefix:"savefrom_ok_audio_download_",infoIdPrefix:"savefrom_ok_audio_info_",lastRow:null,lastRowCandidate:null,timer:0,jsessionId:"",clientHashV:"",scriptNode:null,cache:{payloadTracks:{}},ajaxTimer:{},trackIdPromise:{},appendDownloadMobileMusic:function(e){var t=O.a.create("a",{style:{position:"absolute",top:"-6px",left:"16px"},append:[d.svg.getSvg("download","#f1bc7f",14,14)],on:["click",function(){var t=Object(c.a)(u.a.mark((function t(n){var o,r,a=this;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),n.stopPropagation(),o=C(e),t.next=5,Object(_.a)([o],(function(e){var t=document.querySelector(e);if(t)return t.okData}));case 5:if((r=t.sent)&&r.track){t.next=9;break}return U.error("okData not found"),t.abrupt("return");case 9:U.log("track info",r),K.prepareTrackForDownload(r.track.id).then((function(e){d.download(e.filename,e.downloadUrl)}),(function(e){U.error("appendDownloadMobileMusic. click download error",e),a.style.opacity=.3}));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()]}),n=e.querySelector(".music_track_aux");n&&n.appendChild(t)},prepareTrackForDownload:function(e){return Object(c.a)(u.a.mark((function t(){var n,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(K.jsessionId){t.next=3;break}return t.next=3,K.getJsSessionId();case 3:return t.next=5,K.getTrackUrlById(e);case 5:if((n=t.sent).track){t.next=8;break}throw new Error("Track is not found");case 8:if(n.play){t.next=10;break}throw new Error("Track url is not found");case 10:return t.next=12,K.getClientHash(n.play);case 12:return o=t.sent,t.abrupt("return",{filename:M.a.modify("".concat(n.track.ensemble," â€“ ").concat(n.track.name,".mp3")),downloadUrl:"".concat(n.play,"&").concat(H.stringify({clientHash:o})),duration:n.track.duration,size:n.track.size||-1});case 14:case"end":return t.stop()}}),t)})))()},showRowElements:function(e,t,n){if(e){var o=e.querySelectorAll("div.savefrom_ok_download");o=e.querySelectorAll("div.savefrom_ok_download");for(var r=0;r<o.length;r++)o[r].style.display=t?"":"none"}},getNodeTrackId:function(e){var t=e.getAttribute("data-query");if(t)try{if((t=JSON.parse(t))&&t.trackId)return t.trackId}catch(e){return null}var n=e.querySelector("span.track_play[onclick]");if(n){var o=/(?:playMediatopic|playFeedTrack)\(['"]?(\d+)['"]?/.exec(n.getAttribute("onclick"));return o&&o[1]}return e.dataset.trackId?e.dataset.trackId:null},getTrackId:function(e){var t=K.getNodeTrackId(e);if(t)return(o={})[t]=e,o;var n=e.id;if(n){var o,r=n.indexOf("#");if(-1!==r&&(n=n.substr(r+1)),(t=d.getMatchFirst(n,/^\w+_(\d+)$/i))||-1!==n.indexOf("GROUP_FEED")&&(t=n.substr(n.lastIndexOf("_")+1)),t)return(o={})[t]=e,o}return null},showRowLinks:function(e){var t=K.getTrackId(e);for(var n in t)if(K.handleRow(n,t[n]))return!0;return!1},disable:function(){K.lastRowCandidate=null,K.lastRow=null;for(var e,t=document.querySelectorAll(".savefrom_ok_download"),n=0;e=t[n];n++)e.parentNode.removeChild(e)},getJsSessionId:function(){return("m.ok.ru"===location.host?function(){for(var e=Array.from(document.querySelectorAll("script")),t=0;t<e.length;t++)if(e[t].textContent){var n=e[t].textContent.match(/"jsid":"(.*?)"/);if(n&&n[1])return Promise.resolve(n[1])}return Promise.resolve(void 0)}:function(){return new Promise((function(e,t){var n=location.protocol+"//"+location.host+"/web-api/music/conf";Object(w.a)({type:"POST",url:n,data:"_",json:!0,localXHR:!0},(function(n,o,r){!n&&r&&r.sid?e(r.sid):t(new Error("Get jsSessionId error!"))}))}))})().then((function(e){K.jsessionId=e}),(function(e){U.debug("getJsSessionId error",e)}))},getLink:function(e){e&&K.jsessionId&&(K.ajaxTimer[e]=window.setTimeout((function(){delete K.ajaxTimer[e],K.deleteLink(e)}),3e4),l.a.sendMessage({action:"getOdnoklassnikiAudioLinks",url:location.href,trackId:e,jsessionId:K.jsessionId},(function(e){K.setLink(e.trackId,e.data)})))},onMouseOver:function(){if(K.jsessionId){var e=this;e&&(K.lastRowCandidate=e,clearTimeout(K.timer),K.lastRow!==e&&(K.timer=window.setTimeout((function(){K.showRowElements(K.lastRow,!1),K.lastRow=e,K.lastRowCandidate=null,K.showRowElements(K.lastRow,!0)}),250)))}},onMouseOut:function(){var e=this;(K.lastRow&&K.lastRow.contains(e)||K.lastRowCandidate&&K.lastRowCandidate.contains(e))&&(clearTimeout(K.timer),K.timer=window.setTimeout((function(){K.showRowElements(K.lastRow,!1),K.lastRow=null,K.lastRowCandidate=null}),1e3)),e=null},onNewMouseEnter:function(e){var t=this;if(!this.querySelector(".".concat("savefrom_ok_download"))){var n=C(this);if(document.querySelector(n)!==this)throw new Error("Node path is incorrect");return K.getNodeTrack(n).then((function(e){"WM-TRACK2"===t.tagName?K.insertButtonOnOver(t,e):K.insertButton(t,e)}))}},insertButtonOnOver:function(e,t){var n=this,o=new(Object(j.a)())((function(o){if(!S)return r();for(var a=null,i=null,s=0;a=o.shift();)if("childList"===a.type&&a.target===e)for(s=0,a.addedNodes;i=a.addedNodes[s];s++)if("SLOT"===i.tagName&&"controls"===i.name){e.querySelector(".".concat("savefrom_ok_download"))||(n.insertButton(e,t),r());break}})),r=function(){o.disconnect()};o.observe(e,{childList:!0})},insertButton:function(e,t){var n=["sf-audio","savefrom_ok_download"],o=null;if("WM-TRACK"===e.tagName?o=e.querySelector(".wm-track_controls"):"WM-TRACK2"===e.tagName&&(n.push("sf-audio-2"),o=e.querySelector('slot[name="controls"]')),e.classList.contains("track-with-cover")&&(o=e.querySelector('[data-l="t,addTrack"]')),!o){var r=e.querySelector('slot[name="controls"], wm-duration');o=document.createElement("div"),e.insertBefore(o,r)}var a=O.a.create("a",{href:"#",data:{state:"idle",trackId:t.id},class:n,style:{display:"none",position:"relative",width:"16px",height:"16px",verticalAlign:"middle"},on:[["mouseenter",K.handlePreload],["click",K.handleClickNewButton],["mouseenter",function(){$.tooltip.textContent=K.getNewButtonTooltipLabel(this),$.show(this)}],["mouseleave",function(){$.hide()}],["sf-state-change",function(){$.tooltip.textContent=K.getNewButtonTooltipLabel(this),$.updatePos(this)}],["mouseover",function(e){if(V){if(!e.altKey&&!e.ctrlKey)return e.preventDefault(),void Object(F.b)(a,{defaultWidth:400,defaultHeight:60});Object(F.a)(a,{defaultWidth:400,defaultHeight:60})}}]]});Object(B.a)({category:"append",subcategory:"ok",event:"b"}),o.appendChild(a)},getNewButtonTooltipLabel:function(e){switch(e.dataset.state){case"pending":return"...";case"done":var t=JSON.parse(e.dataset.data),n=t.duration,o=t.size,r="";if(o){var a=d.sizeHuman(o,2);if(n){var i=Math.floor(o/n/125)+" "+l.a.i18n.getMessage("kbps");r="".concat(a," ~ ").concat(i)}else r="".concat(a)}else r=l.a.i18n.getMessage("getFileSizeFailTitle");return r;case"error":return l.a.i18n.getMessage("noLinksFound");default:return""}},handlePreload:function(e){var t=this,n=e.target.closest("wm-track")||e.target.closest("wm-track2"),o=C(n);K.getNodeTrack(o).then((function(n){t.dispatchEvent(new CustomEvent("sf-state-change"));var o=t.dataset.trackId=n.id;return K.prepareTrackForDownload(o).then((function(n){t.href=n.downloadUrl,t.download=n.filename,t.dataset.data=JSON.stringify({duration:n.duration,size:n.size}),t.dataset.state="done",t.dispatchEvent(new CustomEvent("sf-state-change")),t.dataset.downloadOnReady>0&&K.handleClickNewButton.call(t,e)}),(function(e){U.error("handlePreload error",e),t.dataset.state="error",t.dispatchEvent(new CustomEvent("sf-state-change"))}))}))},handleClickNewButton:function(e){e.stopPropagation(),"done"!==this.dataset.state?(e.preventDefault(),"1"!==this.dataset.downloadOnReady&&(this.dataset.downloadOnReady="1")):d.downloadOnClick(e)},getTrackUrlById:function(e){var t=this;return Object(c.a)(u.a.mark((function n(){var o,r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.trackIdPromise[e]){n.next=2;break}return n.abrupt("return",t.trackIdPromise[e]);case 2:if(!K.cache.payloadTracks[e]){n.next=4;break}return n.abrupt("return",K.cache.payloadTracks[e]);case 4:return r="https://wmf.ok.ru/play;jsessionid=".concat(K.jsessionId,"?")+H.stringify({tid:e}),n.abrupt("return",t.trackIdPromise[e]=(o=Object(_.a)([r],"function(url){return fetch(url).then(function(response){return response.json()})}").then((function(t){var n=Object.keys(K.cache.payloadTracks);return n.length>20&&delete K.cache.payloadTracks[n[0]],K.cache.payloadTracks[e]=t,t}))).then.apply(o,Object(s.a)(Object(L.a)((function(){delete t.trackIdPromise[e]})))));case 6:case"end":return n.stop()}}),n)})))()},getNodeTrack:function(e){return Object(_.a)([e],'function(nodePath){var el=document.querySelector(nodePath);if(el&&el.props&&el.props.track){return el.props.track}if(el&&el.model&&el.model._data.get("track")){return el.model._data.get("track")}throw new Error("Track information not found")}')},getNodePath:function(e){for(var t=[];e.parentNode&&1===e.parentNode.nodeType;){var n="",o=[].slice.call(e.parentNode.childNodes);o.length>1&&(n=":nth-child(".concat(o.indexOf(e)+1,")")),t.unshift("".concat(e.tagName).concat(n)),e=e.parentNode}return t.join(">")},handleRow:function(e,t){if(!e||!t)return!1;var n=t;n.style.position="relative";var o=t.querySelector(".m_c_duration, .m_portal_duration"),r=document.createElement("div");r.className="savefrom_ok_download";var a=40,i=document.getElementById("mmpcw");i&&i.contains(t)&&(a=65),d.setStyle(r,{color:"#fff",background:"#46aa19",border:"1px solid #337d12",borderRadius:"3px",padding:"1px 5px",position:"absolute",right:a+"px",top:"50%",lineHeight:"15px",fontSize:"12px",opacity:0,zIndex:9999,cursor:"pointer"}),r.addEventListener("click",K.onBoxClick,!1),r.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1);var s=K.getTitle(e,t),c=function(e,t,n){null==n&&(n=!0);var o=document.createElement("a");return o.href=e,o.className="savefrom_ok_download",o.textContent=t,n&&o.setAttribute("target","_blank"),o}("#","...");c.id=K.downloadIdPrefix+e,c.title=l.a.i18n.getMessage("downloadTitle"),o&&c.setAttribute("data-savefrom-helper-duration",K.secondsFromDurationNode(o)),s&&(s+=".mp3",c.setAttribute("download",M.a.modify(s))),d.setStyle(c,{color:"#fff",fontWeight:"normal"}),c.addEventListener("click",K.onDownloadLinkClick,!1),r.appendChild(c),n.appendChild(r),K.cache[e]?K.setLinkFromCache(e,c):K.getLink(e),r.style.marginTop="-"+r.offsetHeight/2+"px",r.style.opacity="1";var u=document.createElement("span");return u.textContent=String.fromCharCode(215),u.title=l.a.i18n.getMessage("close"),d.setStyle(u,{color:"#fff",fontFamily:"Tahoma,Helvetica,sans-serif",fontSize:"15px",marginLeft:"7px",opacity:".7",cursor:"pointer"}),u.addEventListener("click",K.onCloseBtnClick,!1),r.appendChild(u),!0},onBoxClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.querySelector("a.savefrom_ok_download");return t?(x.a.trigger(t,"click",{cancelable:!0}),!1):(this.style.display="none",!1)},onDownloadLinkClick:function(e){return 2!=e.button&&(e.stopPropagation(),"#"==this.href?(e.preventDefault(),!1):(d.downloadOnClick(e),!1))},onCloseBtnClick:function(e){if(2==e.button)return!0;e.preventDefault(),e.stopPropagation();var t=Object(b.a)(this,".savefrom_ok_download");return t&&(t.style.display="none"),!1},deleteLink:function(e,t){if(!t&&e&&(t=document.getElementById(K.downloadIdPrefix+e)),t){var n=t.parentNode;n&&n.parentNode.removeChild(n)}},getHash:function(e,t){t||(t=[4,3,5,6,1,2,8,7,2,9,3,5,7,1,4,8,8,3,4,3,1,7,3,5,9,8,1,4,3,7,2,8]);for(var n=[],o=0;o<e.length;o++)n.push(parseInt("0x0"+e.charAt(o)));var r=[];(e=(e=n).slice(0))[32]=e[31];var a=0;for(o=32;o-- >0;)a+=e[o];for(var i=0;i<32;i++)r[i]=Math.abs(a-e[i+1]*e[i]*t[i]);return r.join("")},setLinkFromCache:function(e,t){if(!K.cache[e])return!1;if(t||(t=document.getElementById(K.downloadIdPrefix+e)),t){t.href=K.cache[e].url,t.textContent="",K.cache[e].downloadAttr&&t.setAttribute("download",K.cache[e].downloadAttr);var n=O.a.create(d.svg.getSvg("download","#ffffff"),{style:{display:"inline-block",width:"16px",height:"16px",verticalAlign:"middle",opacity:"0.9"}});t.appendChild(n);var o=document.createTextNode(K.cache[e].info);return t.nextSibling?t.parentNode.insertBefore(o,t.nextSibling):t.parentNode.appendChild(o),!0}},getClientHash:function(e){var t;return Promise.resolve((t=n(108),function(e,t){for(var n,o=[4,3,5,6,1,2,8,7,2,9,3,5,7,1,4,8,8,3,4,3,1,7,3,5,9,8,1,4,3,7,2,8],r=t(/md5=(\w*)/g.exec(e)[1]+"secret"),a=r.length,i="",s=0,c=0;c<a;c++)s+=parseInt(r[c],16);for(var d=0;d<a;d++){var u=parseInt(r[d],16);n=d===a-1?u:parseInt(r[d+1],16),i+=Math.abs(s-u*n*o[d])}return i}(e,(function(e){return t(e).toString()}))))},setLink:function(e,t,n){if(e){clearTimeout(K.ajaxTimer[e]);var o=document.getElementById(K.downloadIdPrefix+e);if(o&&!K.setLinkFromCache(e,o)){if(!t||!t.play)return K.deleteLink(e,o),void(o.textContent="?");if(void 0===n)return this.getClientHash(t.play).then((function(n){K.setLink(e,t,n)}),(function(t){K.deleteLink(e,o)}));var r=t.track&&t.track.size||-1;K.cache[e]={},K.cache[e].url=t.play+(n?"&clientHash="+n:"");var a=" ("+d.sizeHuman(r,2),i=o.getAttribute("data-savefrom-helper-duration");if(t.track&&(t.track.duration&&(i=t.track.duration),t.track.ensemble&&t.track.name)){var s=t.track.ensemble+" - "+t.track.name;K.cache[e].title=s,K.cache[e].downloadAttr=M.a.modify(s+".mp3")}if(r&&r>0&&i){if(i=parseInt(i),isNaN(i))return void delete K.cache[e];a+=" ~ "+(Math.floor(r/i/125)+" "+l.a.i18n.getMessage("kbps"))}a+=")",K.cache[e].info=a,K.setLinkFromCache(e,o)}}},getTitle:function(e,t){if(!e||!t)return"";var n="",o=t.querySelector(".m_c_artist, .mus-tr_artist, .m_portal_c_artist"),r=t.querySelector(".m_track_source, .mus-tr_song, .m_portla_track_name");return o&&(o=o.textContent)&&(n+=o.trim()),r&&(r=r.textContent)&&(n&&(n+=" - "),n+=r.trim()),n?n.replace(/\<a\s+[^\>]+\>/gi,"").replace(/\<\/a\>/gi,""):""},secondsFromDurationNode:function(e){if(!e)return 0;var t=e.textContent;if(!t)return 0;var n=t.match(/^(?:\s*(\d+)\s*\:)?\s*(\d+)\s*\:\s*(\d+)/);return n&&n.length>3?(n[1]||(n[1]=0),3600*parseInt(n[1])+60*parseInt(n[2])+parseInt(n[3])):0},getPlaylistName:function(e){if(e!==document){var t=e.querySelector(".mus_h2_tx");if(t)return M.a.modify(t.textContent)||void 0}},getNewPlaylistName:function(e){if(e!==document){var t=e.querySelector(".wm-list-description_header");if(t)return M.a.modify(t.textContent)||void 0}},elIsHidden:function(e){return null===e.offsetParent},getLayer:function(){var e=document.querySelector("#mmpcw");if(e&&!e.classList.contains("__hidden")&&(e=e.querySelector('div.m_c_s[aria-hidden="false"]'))&&!K.elIsHidden(e))return e},getNewLayer:function(){var e=document.querySelector("#music_layer wm-collection-section");if(e||(e=document.querySelector("#music_layer")),!e||!K.elIsHidden(e))return e},getPopup:function(e,t,n){var o,r=d.playlist.getInfoPopupTemplate();O.a.create(r.textContainer,{append:[e?O.a.create("p",{text:e,style:{color:"#0D0D0D",fontSize:"20px",marginBottom:"11px",marginTop:"13px"}}):void 0,o=O.a.create("p",{text:"",style:{color:"#868686",fontSize:"14px",lineHeight:"24px"}})]});var a=d.popupDiv(r.body,"sf_progress_popup",void 0,void 0,n),i=function e(n){e.state!==n&&(e.state=n,r.buttonContainer.style.display="none",o.style.display="none",l.a.sendMessage({action:"getWarningIcon",type:t,color:"#77D1FA"},(function(e){r.icon.style.backgroundImage="url("+e+")"})),"progress"===n&&(o.style.display="block"),"error"===n&&(l.a.sendMessage({action:"getWarningIcon",type:t,color:"#AAAAAA"},(function(e){r.icon.style.backgroundImage="url("+e+")"})),o.style.display="block"))};return{onPrepare:function(e){i("progress"),o.textContent=e},onProgress:function(e,t){o.textContent=l.a.i18n.getMessage("vkFoundFiles").replace("%d",e)+" "+l.a.i18n.getMessage("vkFoundOf")+" "+t},onReady:function(){x.a.trigger(a,"kill")},onError:function(e){i("error"),o.textContent=e}}},getAudioLinksViaAPI:function(e,t,n){var o=!1,r=[],a=e.length;return function i(){if(!o){var s=e.splice(0,10);if(0===s.length)return n(r);l.a.sendMessage({action:"getOkAudioListLinks",trackIdArr:s,jsessionId:K.jsessionId},(function(n){var o=Promise.resolve();Array.isArray(n)&&n.forEach((function(e){o=o.then((function(){if("string"==typeof e.play&&"object"==typeof e.track){var t,n=e.play;return e.track.name&&(t=e.track.name),e.track.ensemble&&(t=e.track.ensemble+(t?" - "+t:"")),t||(t="noname"),K.getClientHash(n).then((function(o){n+="&clientHash="+o,r.push({url:n,duration:e.track.duration||0,title:t,filename:M.a.modify(t)+".mp3"})}))}})).catch((function(t){U.debug("process item error",e,t)}))})),o.then((function(){t(a-e.length,a),i()}))}))}}(),{abort:function(){o=!0}}},getAudioListLinksPopup:function(e,t,n){var o,r=this.getPopup(t,"audio",(function(){o&&o.abort()}));r.onPrepare(l.a.i18n.getMessage("download")+" ..."),o=this.getAudioLinksViaAPI(e,r.onProgress,(function(e){0!==e.length?(r.onReady(),n(e)):r.onError(l.a.i18n.getMessage("vkMp3LinksNotFound"))}))},getAudioLinksIds:function(e){return Promise.resolve().then((function(){for(var t,n=e.querySelectorAll([".m_portal_track",".m_c_tr",".mus-tr_i"]),o=[],r=0;t=n[r];r++){var a=K.getTrackId(t);for(var i in a)o.push(i)}return o}))},getNewAudioLinksIds:function(e){var t=C(e);if(!t||document.querySelector(t)===e)return Object(_.a)([t],'function(nodePath){var result=null;try{var container=nodePath===""?document:document.querySelector(nodePath);var ids=[].slice.call(container.querySelectorAll(["wm-track","wm-track2"])).reduce(function(result,node){try{var getTrack=function getTrack(){if(node&&node.props&&node.props.track){return node.props.track}if(node&&node.model&&node.model._data.get("track")){return node.model._data.get("track")}throw new Error("getNewAudioLinksIds")};var track=getTrack();if(track){result.push(track.id)}}catch(err){// console.error(\'getNewAudioLinksIds error\', err);\n}return result},[]);result={result:ids}}catch(err){result={error:{message:err.message,stack:err.stack}}}if(result.error){throw new Error(result.error.message)}else{return result.result}}')},getAudioFromWall:function(e){return Object(c.a)(u.a.mark((function t(){var n,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.querySelector(".media-layer.__active"),o=(e=n||e).querySelectorAll(".track-with-cover_cnt"),t.abrupt("return",Array.from(o).map((function(e){return e.closest(".track-with-cover").dataset.trackId})));case 4:case"end":return t.stop()}}),t)})))()},getAudioLinks:function(e,t,n){var o=this;return Promise.all([this.getAudioLinksIds(e),this.getNewAudioLinksIds(e),this.getAudioFromWall(e)]).then((function(e){var t;return(t=[]).concat.apply(t,Object(s.a)(e)).filter((function(e,t,n){return n.indexOf(e)===t}))})).then((function(e){o.getAudioListLinksPopup(e,t,n)}))},downloadMP3Files:function(){var e=K.getLayer()||K.getNewLayer()||document,t=K.getPlaylistName(e)||K.getNewPlaylistName(e);K.getAudioLinks(e,t,(function(e){d.downloadList.showBeforeDownloadPopup(e,{type:"audio",folderName:t})}))},showListOfAudioFiles:function(e){var t=K.getLayer()||K.getNewLayer()||document,n=K.getPlaylistName(t)||K.getNewPlaylistName(t);K.getAudioLinks(t,n,(function(t){t.length?e?d.playlist.popupPlaylist(t,n,!0):d.playlist.popupFilelist(t):alert(l.a.i18n.getMessage("vkMp3LinksNotFound"))}))}},G={requestMobileToken:function(e,t){var n=null;e.links.some((function(e){var t=e.url.match(/\/\/([^/]+)/);if(t=t&&t[1])return n=t,!0}));var o=function(e){return new Promise((function(t){var n=new XMLHttpRequest;n.open("POST",location.protocol+"//"+e+"/usr_login",!1),n.withCredentials=!0,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.onreadystatechange=function(){try{var e=JSON.parse(n.responseText);if(!e.vtkn||!e.ttl)return t();t({ttl:e.ttl,vtkn:e.vtkn})}catch(e){}},n.send()}))};Object(_.a)((function(){var e=document.cookie&&document.cookie.match(/vdsig=([^;]+);/);if(e&&e[1])return e[1]})).then((function(r){if(r)return e.vtkn=r,t(e);var a=function(n){var o=n.ttl,r=n.vtkn;o&&r&&(z.videoToken={ttl:Date.now()+1e3*o,vtkn:r},e.vtkn=r,t(e))};l.a.isChrome||l.a.isFirefox?Object(_.a)([n],o).then(a):o(n).then(a)}))},getMobileToken:function(e,t){if(e.vtkn)return t(e);var n=z.videoToken;return n&&n.expire>Date.now()?(e.vtkn=n.vtkn,t(e)):G.requestMobileToken(e,t)},wrapMobileLinks:function(e,t){G.getMobileToken(e,(function(e){if(!e||!e.vtkn)return t();e.action="getOkViaMobileWrapped",e.links.forEach((function(t){var n=/\?/.test(t.url)?"&":"?";t.url+=n+"vdsig="+e.vtkn})),t(e)}))},prepareResponse:function(e,t){var n=function(){t(l.a.i18n.getMessage("noLinksFound"))};if(!e||!e.links)return n();if(!p.showUmmyItem&&"getRutubeLinks"===e.action)return n();if("getOkViaMobile"===e.action)return G.wrapMobileLinks(e,(function(e){if(!e)return n();G.prepareResponse(e,t)}));var o=null;"getYoutubeLinks"===e.action?o="youtube":"getVimeoLinks"===e.action?o="vimeo":"getDailymotionLinks"===e.action?o="dailymotion":"getRutubeLinks"===e.action&&(o="rutube");var r=null;return r=o?d.popupMenu.prepareLinks[o](e.links,e.title):Y.prepareLinks(e.links,e.title),t(r)},matchOpenGraph:function(e){if(e&&e.movie&&e.movie.contentId){var t=e.movie.contentId;if(-1!==t.indexOf("rutube.")&&p.showUmmyItem)return{action:"getRutubeLinks",links:[t]};if(-1!==t.indexOf("pladform")){var n=Object(v.a)(t);return{action:"getPladformVideo",extVideoId:{playerId:n.pl,videoId:n.videoid}}}var o=d.embedDownloader.checkUrl(t);if(o)return o;var r=e.movie.poster;if("string"==typeof r){var a=(Object(v.a)(r).url||r).match(/ytimg\.com\/vi\/([^\/]+)\//);if(a=a&&a[1])return{action:"getYoutubeLinks",extVideoId:a}}}},switchMetadataProvider:function(e){if(e&&e.provider&&e.movie)switch(e.provider){case"USER_YOUTUBE":if(e.movie.contentId)return{request:{action:"getYoutubeLinks",extVideoId:e.movie.contentId}};break;case"OPEN_GRAPH":var t=this.matchOpenGraph(e);if(t)return{request:t};break;case"LIVE_TV_APP":case"SLIDE_SHOW":case"LIVE_TV_ODKL":case"UPLOADED_ODKL":case"UPLOADED_ATTACHMENT":case"UPLOADED":case"PARTNER":case"YKL":if(e.videos&&e.movie.title)return{request:{action:"wrapMobileLinks",title:e.movie.title,links:e.videos}}}},getPlayerMetadata:function(e,t,n,o){var r={cmd:"videoPlayerMetadata",mid:e,rnd:Date.now()};o&&(r.mtId=t),Object(w.a)({method:"POST",url:location.protocol+"//"+location.host+"/dk?"+H.stringify(r),json:!0,localXHR:!0},(function(r,a,i){return r?!o&&t?void G.getPlayerMetadata(e,t,n,1):n():n(i)}))},getEmbed:function(e,t){var n=Object(v.a)(e);if(!n.id||!n.sig)return t();var o="http://cdn-ok.com/video/get/?"+H.stringify({id:n.id,format:1,sig:n.sig,sig2:"oldRotator"});l.a.sendMessage({action:"getData",url:o},(function(e){return e&&Object(g.a)(e,[/"sourceType":/,/"sourceId":/]).some((function(e){if("youtube"===e.sourceType&&e.sourceId)return t({request:{action:"getYoutubeLinks",extVideoId:e.sourceId}}),!0}))?void 0:t()}))},readMetadata:function(e,t,n){if(e.movie&&/cdn-ok\.com\/embed/.test(e.movie.contentId))return this.getEmbed(e.movie.contentId,(function(e){if(!e||!e.request)return t();l.a.sendMessage(e.request,(function(e){G.prepareResponse(e,t)}))}));if(!n&&e.movie&&e.movie.movieId){var o=e.movie.link&&Object(v.a)(e.movie.link,{sep:"&amp;"})["st.vpl.sid"];return this.getPlayerMetadata(e.movie.movieId,o,(function(n){G.readMetadata(n||e,t,1)}))}var r=this.switchMetadataProvider(e);return r?r.links?t(r.links):void(r.request?"getRutubeLinks"===r.request.action?G.prepareResponse(r.request,t):"wrapMobileLinks"===r.request.action?G.wrapMobileLinks(r.request,(function(e){G.prepareResponse(e,(function(e){t(e,1)}))})):l.a.sendMessage(r.request,(function(e){G.prepareResponse(e,t)})):t()):t()},prepareVideoUrl:function(e,t){var n=e.split("?"),o=t.split("?"),r=Object(i.a)(o,2),a=r[0],s=r[1];if(!n[1]||!s)return t;if(n=new URLSearchParams(n[1]),s=new URLSearchParams(s),!n.has("type"))return t;var c=n.get("type");return s.has("st.mq")&&s.set("st.mq",c),s.has("st.hls")&&s.set("st.hls","off"),a+"?"+s.toString()},getMobileVideoSrc:function(e){return e&&e.dataMobile&&e.dataMobile.videoSrc?Promise.resolve(e.dataMobile.videoSrc):e&&e.movie&&e.movie.id?Object(N.a)({action:"getOkVideoUrlFromMobile",videoUrl:location.href,videoId:e.movie.id}):Promise.resolve(void 0)},prepareHlsLinks:function(e){var t=e.movie,n=t&&t.title?t.title:e.compilationTitle||document.title,o=new RegExp("RESOLUTION=\\d+x(\\d+)\\n(https?.*?)\\n","g");return Object(R.a)(e.hlsManifestUrl).then((function(e){return Object(D.a)(e.body,o)})).then((function(e){return e.map((function(e){return{title:n,ext:"mp4",format:"MP4",quality:parseInt(e[1]),href:"#mux",forceDownload:!1,noSize:!0,func:function(t){t.preventDefault(),Object(E.a)(Object(T.e)(A.a,{filename:M.a.modify(n)+".mp4",format:"mp4",sources:[{url:e[2],format:"mp4"}],convertType:"hls"}),"sf-muxer-parent")}}}))}))},loadLinks:function(e,t){var n=z.linkCache,o=JSON.stringify(e),r=n[o];if(r)return t.update(r);var a=function(e,r){var a=function(){t.update(l.a.i18n.getMessage("noLinksFound"))};return e?e.hlsManifestUrl?G.prepareHlsLinks(e).then((function(e){t.update(e)}),(function(e){a(),U.error("hls error",e)})):void G.readMetadata(e,(function(e,r){if(!e)return a();Array.isArray(e)&&!e.length&&(r=1),r||(n[o]=e),t.update(e)}),r):a()};e.metadata?a(e.metadata):e.request?"getOkMetadata"===e.request.action?l.a.sendMessage(e.request,a):"getPlayerMetadata"===e.request.action?this.getPlayerMetadata(e.request.extVideoId,e.request.sid,(function(e){a(e,1)})):"getRutubeLinks"===e.request.action?G.prepareResponse(e.request,(function(e){t.update(e)})):l.a.sendMessage(e.request,(function(e){G.prepareResponse(e,(function(e){t.update(e)}))})):t.update(l.a.i18n.getMessage("noLinksFound"))},appendLinkUnderVideo:function(e,t){Object(B.a)({category:"append",subcategory:"ok",event:"b"});var n=e.querySelector(".vp-layer-info_cnt");if(n){var o=n.querySelector(".savefrom_ok_download"),r=O.a.create("span",{className:"savefrom_ok_download",style:{marginLeft:"12px"},on:[["click",function(e){e.stopPropagation()}],["mousedown",function(e){e.stopPropagation()}],["keydown",function(e){e.stopPropagation()}]],append:[O.a.create("a",{href:"#",text:l.a.i18n.getMessage("download"),on:["click",function(n){if(n.preventDefault(),x.a.onRemoveEvent(r,z.hideMenu),z.contextMenu&&z.contextMenu.isShow){if(z.contextMenu.button===this)return void z.hideMenu();z.hideMenu()}var o=z.contextMenu=d.popupMenu.quickInsert(this,l.a.i18n.getMessage("download")+"...","sf-single-video-menu",{parent:e});G.loadLinks(t,o)}]})]});o&&o.parentNode?(o.parentNode.replaceChild(r,o),o=null):n.appendChild(r)}},appendDownloadMobileVideo:function(e){var t={float:"right",display:"flex",alignItems:"center",width:"fit-content"},n=e.querySelector(".widget-list_infos"),o=e.querySelector("[data-video]");if(n&&o){n.querySelector(".widget-list_actors, .ic")||(t.position="absolute",t.top="-7px",t.right="0");var r=G.createMobileDownloadContainer(o,{containerStyle:t,menuClass:"sf-mobile-video-menu"});n.appendChild(r)}},createMobileDownloadContainer:function(e,t){var n=t.containerStyle,o=t.menuClass,r=O.a.create("div",{style:n||{},append:[d.svg.getSvg("download","#f1bc7f",14,14),O.a.create("a",{href:"#",text:l.a.i18n.getMessage("download"),style:{marginLeft:"4px"}})],on:["click",function(t){t.preventDefault(),t.stopPropagation(),z.contextMenu=d.popupMenu.quickInsert(this,l.a.i18n.getMessage("download")+" ...",o,{parent:r||t.target}),G.getMobilePlayerOptions(e).then((function(e){if(!e)return z.contextMenu.update(l.a.i18n.getMessage("noLinksFound"));G.loadLinks(e,z.contextMenu)}))}]});return r},getPlayerOptions:function(e){var t=Object(b.a)(e,"[data-player-element-id][data-options]"),n=t&&t.dataset.options;if(n){try{n=JSON.parse(n)}catch(e){}var o=n.flashvars;if(o){if(o.metadata){var r=null;try{r=JSON.parse(o.metadata)}catch(e){}if(r)return{metadata:r}}if(o.metadataUrl)return{request:{action:"getOkMetadata",url:decodeURIComponent(o.metadataUrl)}};var a=n.url;if(a){var i=d.embedDownloader.checkUrl(a);if(i)return{request:i};if(-1!==a.indexOf("rutube."))return{request:{action:"getRutubeLinks",links:[a]}}}}}},getMobilePlayerOptions:function(e){return Object(c.a)(u.a.mark((function t(){var n,o,r,a,i,s,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{n=JSON.parse(e.dataset.video)}catch(e){}if(n&&n.movieId?(o=n.movieId).indexOf("_")&&(o=o.split("_")[0]):(r=new URLSearchParams(location.search),o=r.get("st.discId")),o){t.next=5;break}return U.error("getMobilePlayerOptions. video id not found"),t.abrupt("return");case 5:return t.next=7,Object(N.a)({action:"okRequestVideoPage",videoId:o});case 7:if(a=t.sent){t.next=11;break}return U.error("getMobilePlayerOptions. videoPage fetch failed"),t.abrupt("return");case 11:if(i=q(a,""),s=i.querySelector(".vp_video .vid-card_cnt")){t.next=16;break}return U.error("getMobilePlayerOptions. Video dataset not found"),t.abrupt("return");case 16:return(c=G.getPlayerOptions(s)).metadata?c.metadata.dataMobile=n:c.metadata={dataMobile:n},t.abrupt("return",c);case 19:case"end":return t.stop()}}),t)})))()},catchPopup:function(){var e=null;this.lastWaitEl&&this.lastWaitEl.abort(),this.lastWaitEl=this.waitEl((function(){if(e=document.querySelector(".vp_video .vid-card_cnt"))return e}),(function(){var t=Object(b.a)(e,".vp_video");if(t){var n=G.getPlayerOptions(e);n&&G.appendLinkUnderVideo(t.parentNode,n)}}))},rmBtn:function(){for(var e,t=document.querySelectorAll(".savefrom_ok_download"),n=0;e=t[n];n++)e.parentNode.removeChild(e)},lastWaitEl:null,waitEl:function(e,t,n){var o,r=Object.assign({abort:function(){clearInterval(r.timeout),r.isAborted=!0}},{delay:500,repeat:12,isAborted:!1,timeout:null},n);return(o=e())?(t(o),r):(function n(){r.repeat--,r.timeout=setTimeout((function(){if(!r.isAborted)return(o=e())?t(o):void(!r.isAborted&&r.repeat&&n())}),r.delay)}(),r)}},Y={btnClassName:"sf-feed-dl-btn",style:void 0,thumbClassName:"vid-card_img",prepareLinks:function(e,t){if(!e||!e.length)return l.a.i18n.getMessage("noLinksFound");if("string"==typeof e)return e;t=t||"";for(var n,o,r,a,i=[],s=0,c=e.length;s<c;s++){var u=e[s];if("object"==typeof u&&u.url){a=u.url;var f=u.ext;f||(f="MP4",-1!==u.url.indexOf(".mp4")&&(f="MP4"),-1!==a.indexOf(".flv")&&(f="FLV"),-1!==u.url.indexOf(".mov")&&(f="MOV"),-1!==u.url.indexOf(".mpg")&&(f="MPG")),r=(f=f.toLowerCase()).toUpperCase(),o=u.subname||u.quality||u.name||f}else{f="MP4",-1!==(a=u).indexOf(".mp4")&&(f="MP4"),-1!==a.indexOf(".flv")&&(f="FLV"),-1!==a.indexOf(".mov")&&(f="MOV"),-1!==a.indexOf(".mpg")&&(f="MPG"),r=(f=f.toLowerCase()).toUpperCase(),o=f;var p=d.getMatchFirst(e[s],/\.(\d+)\.mp4/i);p&&(o=p)}var h=["mobile","lowest","low","sd","hd","full","quad","ultra"].indexOf(o);-1!==h&&(o=[144,240,360,480,720,1080,1440,"4K"][h]),n={href:a,title:u.title?u.title:t,ext:f,format:r,quality:o,forceDownload:!0},i.push(n)}return i},getPosterData:function(e){var t=Object(b.a)(e,"[hrefattrs]"),n=t&&t.getAttribute("hrefattrs");if(n){var o=Object(v.a)(n,{params:!0}),r=o["st.vpl.sid"],a=o["st.vpl.id"];if(!a){var i=Object(b.a)(e,"[data-id]");if((a=i&&i.dataset.id)&&"c"===a[0])return}if(a&&"OK_"===a.substr(0,3)&&(a=d.getMatchFirst(a,/OK_\d+_(\d+)/)),a)return{request:{sid:r,action:"getPlayerMetadata",extVideoId:a}}}},onBtnClick:function(e){e.preventDefault(),e.stopPropagation();var t=JSON.parse(this.dataset.sfContext);if(x.a.onRemoveEvent(this,z.hideMenu),z.contextMenu&&z.contextMenu.isShow){if(z.contextMenu.button===this)return void z.hideMenu();z.hideMenu()}var n=document.querySelector("#mtLayer.__active #mtLayerMain > div");n||(n=document.getElementById("vv_content")),n||Object(k.a)(this,".js-messages-list "+this.tagName)&&(n=Object(h.a)(this,"js-messages-list"))&&!n.offsetParent&&(n=null),!n&&Object(k.a)(this,"#mainContent "+this.tagName)&&(n=Object(b.a)(this,"#mainContent"));var o=z.contextMenu=d.popupMenu.quickInsert(this,l.a.i18n.getMessage("download")+" ...","sf-popupMenu",{parent:n||void 0});Object(B.a)({category:"download",subcategory:"ok",event:"video"}),G.loadLinks(t,o)},onImgOver:function(e){var t=Object(k.a)(this,".mdialog_chat_window .d_comment_text_w "+this.tagName),n=null;if((t?n=Object(h.a)(this,"d_comment_text_w"):Object(k.a)(this,".video-card > .video-card_img-w "+this.tagName)?n=Object(h.a)(this,"video-card_img-w"):this.classList.contains("vid-card_cnt")?n=this:Object(k.a)(this,".vid-card_cnt "+this.tagName)&&(n=Object(h.a)(this,"vid-card_cnt")),n)&&(!n.getElementsByClassName(Y.btnClassName).length&&!!!n.querySelector(".vid-card_live.__active"))){var o=Object(k.a)(this,".vid-card_img__link "+this.tagName),r=G.getPlayerOptions(this);if(r||(r=Y.getPosterData(this)),r){r.isChat=t;var a={};t&&Object.assign(a,{left:"15px",top:"15px"}),o&&Object.assign(a,{backgroundColor:"#454648",borderColor:"rgb(53, 53, 53)"});var i=O.a.create("i",{class:[Y.btnClassName,"sf-video-feed-bind-on-insert"],style:a,data:{sfContext:JSON.stringify(r)},title:l.a.i18n.getMessage("download")});i.appendChild(O.a.create(d.svg.getSvg("download"),{style:{width:"12px",height:"12px",margin:"4px"}})),n.appendChild(i)}}},injectStyle:function(){var e;this.style?this.style.parentNode||document.head.appendChild(this.style):(this.style=O.a.create("style",{text:Object(y.a)((e={"div > .sf-feed-dl-btn":{display:"none",border:"1px solid #F8F8F8",width:"20px",height:"20px",padding:0,position:"absolute",top:0,left:0,zIndex:1,cursor:"pointer",backgroundColor:"#F8F8F8"},"div > .sf-feed-dl-btn svg path":{fill:"#eb722e"},"div > .sf-feed-dl-btn:hover svg path":{fill:"#00B75A"},"div > .sf-feed-dl-btn:active":{outline:0,boxShadow:"inset 0 3px 5px rgba(0, 0, 0, 0.125)"},"div:hover > .sf-feed-dl-btn":{display:"block"}},Object(a.a)(e,".sf-audio.".concat("savefrom_ok_download"),{display:"none",backgroundImage:"url("+d.svg.getSrc("download","#ee8208")+")",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"16px",opacity:.5,marginLeft:"11px"}),Object(a.a)(e,".sf-audio.sf-audio-2.".concat("savefrom_ok_download"),{margin:"0 6px"}),Object(a.a)(e,".sf-audio.".concat("savefrom_ok_download",":hover"),{opacity:1}),Object(a.a)(e,"wm-track:hover .sf-audio",{display:"flex !important"}),Object(a.a)(e,"wm-track2:hover .sf-audio",{display:"flex !important"}),Object(a.a)(e,"#sf-mobile-video-menu",{left:"auto !important",right:"0"}),e))}),document.head.appendChild(this.style))},disable:function(){this.style&&this.style.parentNode&&this.style.parentNode.removeChild(this.style)},rmBtn:function(){for(var e,t=document.querySelectorAll(".sf-feed-dl-btn"),n=0;e=t[n];n++)e.parentNode.removeChild(e);var o=Object(m.a)("sfSkip2"),r=document.querySelectorAll("["+o+"]");for(n=0;e=r[n];n++)e.removeAttribute(o)}},X={style:null,rmCurrentPhotoBtn:function(e){for(var t,n=void 0,o=document.querySelectorAll(".sf-dl-current-photo-btn"),r=0;t=o[r];r++)e&&e.contains(t)?n=t:t.parentNode.removeChild(t);return n},addDlCurrentPhotoBtn:function(e){if(!this.rmCurrentPhotoBtn(e)){var t=z;e.appendChild(O.a.create("a",{class:"sf-dl-current-photo-btn",href:"#",title:l.a.i18n.getMessage("download"),on:["click",function(n){if(n.stopPropagation(),n.preventDefault(),t.contextMenu&&t.contextMenu.isShow&&t.contextMenu.button===this){if(t.contextMenu.button===this)return void t.hideMenu();t.hideMenu()}var o=function e(t){18!==t.keyCode&&17!==t.keyCode&&(r.hide(),document.removeEventListener("keydown",e))},r=t.contextMenu=d.popupMenu.quickInsert(this,l.a.i18n.getMessage("download")+" ...","photoDlMenu",{parent:e,onShow:function(){document.addEventListener("keydown",o)},onHide:function(){document.removeEventListener("keydown",o)}}),a=[],i=e.querySelector("img.photo-layer_img");if(i){var s=i.dataset.fsSrc||i.dataset.nfsSrc||i.src;s&&a.push({href:s,title:"photo_"+parseInt(Date.now()/1e3),quality:l.a.i18n.getMessage("download"),format:" ",ext:"jpg",forceDownload:!0,isBlank:!0,func:function(){r.hide()}})}if(i||(i=e.querySelector("div.gif[data-gifsrc]")),i){var c={webmsrc:"webm",mp4src:"mp4",gifsrc:"gif"};Object.keys(c).forEach((function(e){var t=i.dataset[e];if(t){var n=c[e];a.push({href:t,title:"gif_"+parseInt(Date.now()/1e3),quality:l.a.i18n.getMessage("download"),format:n.toUpperCase(),ext:n,forceDownload:!0,isBlank:!0,func:function(){r.hide()}})}}))}0!==a.length?r.update(a):r.update(l.a.i18n.getMessage("noLinksFound"))}],append:[O.a.create(d.svg.getSvg("download"),{style:{width:"12px",height:"12px",margin:"4px"}})]}))}},injectStyle:function(){X.style?X.style.parentNode||document.head.appendChild(X.style):(X.style=O.a.create("style",{text:Object(y.a)({"div > .sf-dl-current-photo-btn":{display:"none",border:"1px solid #F8F8F8",width:"20px",height:"20px",padding:0,position:"absolute",backgroundColor:"#F8F8F8",top:"73px",left:"90px",zIndex:100,cursor:"pointer"},"div > .sf-dl-current-photo-btn svg path":{fill:"#eb722e"},"div > .sf-dl-current-photo-btn:hover svg path":{fill:"#00B75A"},"div > .sf-dl-current-photo-btn:active":{outline:0,boxShadow:"inset 0 3px 5px rgba(0, 0, 0, 0.125)"},"div:hover > .sf-dl-current-photo-btn":{display:"block"}})}),document.head.appendChild(X.style))},addCurrentDlBtn:function(e){if("1"!==e.dataset.sfSkip2){e.dataset.sfSkip2="1";var t=e.querySelector("img.photo-layer_img");if(t)t.dataset.fsSrc||t.dataset.nfsSrc||t.src||(t=null);t||(t=e.querySelector("div.gif[data-gifsrc]")),t&&this.addDlCurrentPhotoBtn(e)}}},$=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,e),this.options=t,this.tooltip=null,this.init()}return Object(r.a)(e,[{key:"init",value:function(){var e=this;this.tooltip=O.a.create("div",{class:"sf-tooltip",style:Object.assign({position:"absolute",display:"none",zIndex:9999,opacity:0,transition:"opacity 0.2s",whiteSpace:"nowrap",fontSize:"12px",color:"#111",fontFamily:"arial, verdana, sans-serif, Lucida Sans"},this.options.style),on:["mouseenter",function(t){e.hide()}]}),document.body.appendChild(this.tooltip)}},{key:"updatePos",value:function(e){var t=d.getPosition(e),n=d.getSize(this.tooltip);this.tooltip.style.top=t.top+this.options.top-n.height+"px";var o=t.left+parseInt(this.options.width/2,10)-parseInt(n.width/2,10),r=document.body.clientWidth+document.body.scrollLeft;r<o+n.width&&(o=r-n.width),this.tooltip.style.left=o+"px"}},{key:"show",value:function(e){var t=this;this.tooltip.style.display="block",setTimeout((function(){t.updatePos(e),t.tooltip.style.opacity=1}))}},{key:"hide",value:function(){this.tooltip.style.opacity=0,this.tooltip.style.display="none"}},{key:"destroy",value:function(){this.tooltip.parentNode&&(this.tooltip.parentNode.removeChild(this.tooltip),this.tooltip=null)}}]),e}())({top:-12,width:16,style:{backgroundColor:"#fff",border:"1px solid #ccc",color:"rgb(48, 48, 48)",fontSize:"12px",padding:"3px"}})}))}});