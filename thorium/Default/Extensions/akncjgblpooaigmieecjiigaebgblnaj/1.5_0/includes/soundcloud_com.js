!function(e){function t(t){for(var n,o,i=t[0],c=t[1],s=t[2],l=0,p=[];l<i.length;l++)o=i[l],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(u&&u(t);p.length;)p.shift()();return a.push.apply(a,s||[]),A()}function A(){for(var e,t=0;t<a.length;t++){for(var A=a[t],n=!0,i=1;i<A.length;i++){var c=A[i];0!==r[c]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=A[0]))}return e}var n={},r={11:0},a=[];function o(t){if(n[t])return n[t].exports;var A=n[t]={i:t,l:!1,exports:{}};return e[t].call(A.exports,A,A.exports,o),A.l=!0,A.exports}o.m=e,o.c=n,o.d=function(e,t,A){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:A})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var A=Object.create(null);if(o.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(A,n,function(t){return e[t]}.bind(null,n));return A},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var i=window.savefromContentScriptWebpackJsonp=window.savefromContentScriptWebpackJsonp||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var u=c;a.push([118,0]),A()}({118:function(e,t,A){"use strict";A.r(t);var n=A(14),r=A(10),a=A(6),o=A(7),i=A(17),c=A(18),s=A(12),u=A(5),l=A.n(u),p=A(0),d=A(27),f=A(21),h=A(13),b=A(26),y=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome");function w(e){return e.dataset.sfSongReady=1,e}var k=function(e){return!e.dataset.sfSongReady},g=function(){try{return"Tampermonkey"===GM_info.scriptHandler||"Violentmonkey"===GM_info.scriptHandler}catch(e){return!1}},Q=function(){return!g()&&!(p.a.isGM&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"))},m=function(e){var t=e.downloadURL,A=e.filename;if(g()){var n=document.createElement("a");n.style.display="none",n.href=t,n.setAttribute("target","_blank"),n.download=A,document.body.appendChild(n),n.click(),n.remove()}else{var r=new CustomEvent("song.download",{detail:{downloadURL:t,filename:A}});document.dispatchEvent(r)}},v=function(e){var t=document.createElement("a");return t.target="_blank",e&&t.classList.add("sf--sc-"+e),t.classList.add("sf--sc-btn","sc-button","sc-button-small","sc-button-icon","sc-button-responsive"),t.addEventListener("mouseenter",(function(e){if(y){if(!e.altKey&&!e.ctrlKey)return e.preventDefault(),void Object(b.b)(t,{content:p.a.i18n.getMessage("downloadTitle"),defaultWidth:400,defaultHeight:60});Object(b.a)(t,{content:p.a.i18n.getMessage("downloadTitle"),defaultWidth:400,defaultHeight:60})}})),Object(h.a)({category:"append",subcategory:"so",event:"b"}),t},C=function(e,t){["loading","error","playlist","default"].includes(t)&&(e.classList.remove("sf--sc-loading"),e.classList.add("sf--sc-".concat(t)))},E=function(e){return function(e){try{var t=e.replace(/[^A-Za-zА-Яа-яЁё0-9\s\.\-\(\)\[\]]/g,"").trim();if(""===t||t.length<3||t.test(/\.$/))throw new Error("filename not valid");return t}catch(e){return Date.now()+"_track"}}("".concat(e.title))+".mp3"};function x(e,t){var A=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),A.push.apply(A,n)}return A}function I(e){for(var t=1;t<arguments.length;t++){var A=null!=arguments[t]?arguments[t]:{};t%2?x(Object(A),!0).forEach((function(t){Object(n.a)(e,t,A[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(A)):x(Object(A)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(A,t))}))}return e}function O(e,t){return Object(f.a)({action:"soundcloudFetchPageInfo",clientId:e,songEndpoint:t})}function B(e,t){return M.apply(this,arguments)}function M(){return(M=Object(r.a)(l.a.mark((function e(t,A){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t,A);case 2:if((n=e.sent)&&"track"===n.kind){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,S(t,n);case 7:return r=e.sent,e.abrupt("return",I(I({},n),{},{downloadURL:r,filename:E(n)}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return Object(f.a)({action:"soundcloudSearchBestDownloadURL",clientID:e,song:t})}function D(e,t){return Object(f.a)({action:"soundcloudFetchSongsOfPlaylist",clientID:e,playlist:t})}var j=A(52),J=A(19),K=A(15),L="\n  .sf--sc-btn {\n    background-image: url(".concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAPklEQVR42mNgGHTgvw/DfxgexJqBiuYja8CD55NrwHxyXTCfWP/OJ0sjFgPmkxvXCWRFDy6MT3MDITw40j8Ak46HYQ4gDfUAAAAASUVORK5CYII=",");\n    background-repeat: no-repeat;\n    background-position: 50%;\n  }\n  .sf--sc-playlist {\n    background-image: url(").concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAMUlEQVR42mL8//8/A7mAiYECwILC82Uk7IzN/xmpYjPjqJ9H/UxTP1OkGQAAAP//AwDcahUV6UvyJwAAAABJRU5ErkJggg==",");\n    background-size: 50%;\n  }\n  .sf--sc-loading {\n    background-image: url(").concat("data:image/gif;base64,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",");\n    background-size: 50%;\n  }\n  .sf--sc-error {\n    background-image: url(").concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAVklEQVQoz2P4//8/A7mYgSqa0UF9ff1/GEaXG0SagYrmI2vAg+djtZkIA+bjdTYeA+YT5WcsBswnNcDmY9NIlGaoAQnYxHEFGMHQxqe5gRDGqpnuGQMALmDKhkjc9oYAAAAASUVORK5CYII=",");\n  }\n"),U=A(25),R=A(20),F=function(){function e(t){Object(a.a)(this,e),this.selector='[role="group"].sound.playlist.streamContext',this.type="added",this.clientID=t}var t;return Object(o.a)(e,[{key:"handle",value:function(e){var t=this;e.added.filter(k).map(w).map((function(e){return t.renderDownloadButton(e)}))}},{key:"renderDownloadButton",value:function(e){var t=e.querySelector(".sc-button-group"),A=v("playlist");A.addEventListener("click",this.downloadPlaylist.bind(this)),t.appendChild(A)}},{key:"downloadPlaylist",value:(t=Object(r.a)(l.a.mark((function e(t){var A,n,a,o,i,c,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),A=t.target,C(A,"loading"),e.prev=3,n=t.target.closest(this.selector),a=n.querySelector('a[href*="sets/"]').href,e.next=8,O(this.clientID,a);case 8:if("playlist"===(o=e.sent).kind){e.next=11;break}throw new Error("It's not playlist.");case 11:return e.next=13,D(this.clientID,o);case 13:return i=e.sent,c=i.map(function(){var e=Object(r.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=E(t),e.next=3,S(s.clientID,t);case 3:return e.t1=e.sent,e.abrupt("return",{filename:e.t0,downloadURL:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=17,Promise.all(c);case 17:e.sent.map(m),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(3),C(A,"error"),e.t0;case 24:return e.prev=24,C(A,"default"),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[3,20,24,27]])}))),function(e){return t.apply(this,arguments)})}]),e}(),H=A(11),T=Object(H.a)("userCardSingleTrack"),P=function(){function e(t,A){Object(a.a)(this,e),this.selector='[role="group"].sound.streamContext:not(.playlist)',this.type="added",this.utils=t,this.clientID=A}var t;return Object(o.a)(e,[{key:"handle",value:function(e){var t=this;e.added.filter(k).map(w).map((function(e){return t.renderDownloadButton(e)}))}},{key:"renderDownloadButton",value:function(e){var t=e.querySelector(".sc-button-group");t&&this.btnPrepare(e).then((function(e){e&&t.appendChild(e)}))}},{key:"btnPrepare",value:(t=Object(r.a)(l.a.mark((function e(t){var A,n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A=v(),n=t.closest(this.selector)){e.next=5;break}return T.error("root not found",t),e.abrupt("return");case 5:if(r=n.querySelector("a.soundTitle__title[href]")){e.next=9;break}return T.error("song url not found",t),e.abrupt("return");case 9:return e.next=11,O(this.clientID,r.href);case 11:if((a=e.sent)&&"track"===a.kind){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,S(this.clientID,a);case 16:return A.href=e.sent,A.download=E(a),A.addEventListener("click",this.utils.downloadOnClick),e.abrupt("return",A);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),z=[".listenDetails .trackItem.g-flex-row.sc-type-small .sc-button-group, .chartTrack .sc-button-group",".trackItem.g-flex-row.sc-type-small.m-playable .sc-button-group"].join(","),G=function(){function e(t,A){Object(a.a)(this,e),this.selector=z,this.type="added",this.utils=t,this.clientID=A}var t;return Object(o.a)(e,[{key:"handle",value:function(e){var t=this;e.added.filter(k).map(w).map((function(e){return t.renderDownloadButton(e)}))}},{key:"renderDownloadButton",value:function(e){this.btnPrepare(e).then((function(t){Object(h.a)({category:"append",subcategory:"so",event:"b"}),t&&e.appendChild(t)}))}},{key:"btnPrepare",value:(t=Object(r.a)(l.a.mark((function e(t){var A,n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A=v(),n=t.closest(".sc-type-small, .chartTrack")){e.next=5;break}return debug.error("root not found",t),e.abrupt("return");case 5:if(r=n.querySelector(".trackItem__trackTitle[href], .chartTrack__title [href]")){e.next=8;break}return e.abrupt("return");case 8:return r=r.href,e.next=11,B(this.clientID,r);case 11:if(a=e.sent){e.next=14;break}return e.abrupt("return");case 14:return A.href=a.downloadURL,A.download=a.filename,A.addEventListener("click",this.utils.downloadOnClick),e.abrupt("return",A);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),N=".sidebarContent .sc-media:not(.hiddenActions) .sc-button-group",q=".l-about-top .sc-button-group:nth-child(1)",Y=".l-about-row .sound__soundActions .sc-button-group:nth-child(1)",V=function(){function e(t,A){Object(a.a)(this,e),this.selector=[Y,N,q].join(","),this.type="added",this.utils=t,this.clientID=A}var t,A,n;return Object(o.a)(e,[{key:"handle",value:function(e){var t=this;e.added.filter(k).map(w).map((function(e){return t.renderDownloadButton(e)}))}},{key:"renderDownloadButton",value:function(e){var t,A=Q(),n=A||!A&&-1===location.pathname.indexOf("/sets/");this.isTopSidebar(e)?n&&(t=this.prepareButtonForTop()):t=this.prepareButtonForSidebar(e),t&&t.then((function(t){t&&e.appendChild(t)}))}},{key:"prepareButtonForSidebar",value:(n=Object(r.a)(l.a.mark((function e(t){var A,n,r,a,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A=v(),n=t.closest(".sc-media")){e.next=4;break}return e.abrupt("return");case 4:if((a=n.querySelector(".soundTitle__title[href]"))&&(r=a.href),!a&&document.querySelector(Y)&&(r=location.href),r){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,B(this.clientID,r);case 11:if(o=e.sent){e.next=14;break}return e.abrupt("return");case 14:return A.href=o.downloadURL,A.download=o.filename,A.addEventListener("click",this.utils.downloadOnClick),e.abrupt("return",A);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"prepareButtonForTop",value:(A=Object(r.a)(l.a.mark((function e(){var t,A;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=v()).dataset.position="sidebar",t.style.width=t.style.height="26px",e.next=5,B(this.clientID,location.href);case 5:if(A=e.sent){e.next=10;break}return t.addEventListener("click",this.onDownloadPlaylist.bind(this)),t.classList.remove("sc-button-small"),e.abrupt("return",t);case 10:return t.href=A.downloadURL,t.download=A.filename,t.addEventListener("click",this.utils.downloadOnClick),e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"onDownloadPlaylist",value:(t=Object(r.a)(l.a.mark((function e(t){var A,n,a,o=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),t.stopPropagation(),e.next=4,O(this.clientID,location.href);case 4:return A=e.sent,e.next=7,D(this.clientID,A);case 7:return n=e.sent,a=n.map(function(){var e=Object(r.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=E(t),e.next=3,S(o.clientID,t);case 3:return e.t1=e.sent,e.abrupt("return",{filename:e.t0,downloadURL:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=11,Promise.all(a);case 11:e.sent.map(m);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"isTopSidebar",value:function(e){return null!==e.closest(".l-about-top")}}]),e}();function W(e,t){var A=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),A.push.apply(A,n)}return A}function Z(e){for(var t=1;t<arguments.length;t++){var A=null!=arguments[t]?arguments[t]:{};t%2?W(Object(A),!0).forEach((function(t){Object(n.a)(e,t,A[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(A)):W(Object(A)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(A,t))}))}return e}function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var A,n=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;A=Reflect.construct(n,arguments,r)}else A=n.apply(this,arguments);return Object(c.a)(this,A)}}var _=function(e){Object(i.a)(n,e);var t,A=X(n);function n(){var e;Object(a.a)(this,n);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(e=A.call.apply(A,[this].concat(r))).mutationHandlers=[],e.active=1,e}return Object(o.a)(n,[{key:"init",value:(t=Object(r.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.callFn("getPreferences");case 2:if(this.settings=e.sent,this.utils=Object(J.a)({preferences:this.settings}),this.active=Number(this.settings.moduleSoundcloud),this.clientId=this.cache.get("client_id"),this.clientId){e.next=10;break}return e.next=9,Object(d.a)('function(){var wpchunk=window.webpackChunk||window.webpackJsonp;if(typeof wpchunk==="undefined"){return}var _result;var sections=wpchunk.filter(function(v,k){return k!=="push"});// check fn\nfor(var id in wpchunk){var chunk=wpchunk[id];if(chunk[1]&&chunk[1][41021]){var matches=chunk[1][41021].toString().match(/\\?client_id=(.+?)&/);if(Array.isArray(matches)&&matches[1]){return matches[1]}}}sections.some(function(section){var obj=section[1];return Object.keys(obj).some(function(fnIdx){var result=obj[fnIdx].toString().match(/\\"client_id=\\w+\\"/);if(result&&result[0]){return _result=result[0].split("=")[1].replace(/\\"/,"")}})});return _result}');case 9:this.clientId=e.sent;case 10:this.registerMonoListeners(),this.registerListeners(),this.active&&this.initObserver(),this.appendStyle(L);case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerListeners",value:function(){var e=this;document.addEventListener("song.download",(function(t){var A=t.detail;e.utils.download(A.filename,A.downloadURL)}))}},{key:"registerMonoListeners",value:function(){var e=this;p.a.onMessage.addListener(function(){var t=Object(r.a)(l.a.mark((function t(A,r,a){var o,i,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=A.action,i=A.moduleName,c=A.state,i===n.moduleName){t.next=3;break}return t.abrupt("return");case 3:if("getModuleInfo"!==o){t.next=5;break}return t.abrupt("return",a({state:e.active,moduleName:n.moduleName}));case 5:if("updatePreferences"!==o){t.next=7;break}return t.abrupt("return",(r=A.preferences,e.settings=Z(Z({},e.settings),{},{preferences:r})));case 7:if("changeState"!==o){t.next=14;break}if(!c){t.next=10;break}return t.abrupt("return",e.initObserver());case 10:e.observer.stop(),document.querySelectorAll(".sf--sc-btn").forEach((function(e){return e.remove()})),document.querySelectorAll('[data-sf-song-ready="1"]').forEach((function(e){e.removeAttribute("data-sf-song-ready")}));case 14:case"end":return t.stop()}var r}),t)})));return function(e,A,n){return t.apply(this,arguments)}}())}},{key:"initObserver",value:function(){var e=this.clientId;this.mutationHandlers=[new P(this.utils,e),new G(this.utils,e),new V(this.utils,e)],Q()&&this.mutationHandlers.push(new F(e));this.observer=new K.a({queries:this.mutationHandlers.map((function(e){return{css:e.selector,callback:e.handle.bind(e),is:e.type}}))}),this.observer.start()}}]),n}(j.a);_.moduleName="soundcloud";var $=new _;U.a.isSingle()&&Object(R.a)(_.moduleName,(function(){return $.init()}),(function(){return!0}))}});